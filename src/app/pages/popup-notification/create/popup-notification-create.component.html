<div class="page-layout simple fullwidth" fxLayout="column" fusePerfectScrollbar>
  <!-- HEADER -->
  <page-content-header contentTitle="{{'notification.buat_notifikasi.title' | translate}}"></page-content-header>
  <!-- / HEADER -->

  <div class="content p-24">
    <div class="ayo-main-wrapper mat-white-bg p-0" fxLayout="column" fusePerfectScrollbar>
      <form autocomplete="off" [formGroup]="formPopupGroup">
        <div fxLayout="row" class="px-24" fxLayoutAlign="space-between center">
          <h2 class="">{{'notification.buat_notifikasi.title' | translate}}</h2>
          <div>
            {{'notification.popup_notifikasi.text21' | translate}}
            <mat-slide-toggle [formControl]="is_mission_builder" name="is_mission_builder"
              (change)="selectChange($event)"></mat-slide-toggle>
          </div>
        </div>
        <div class="ayo-middle" fxLayout="column">
          <div class="mt-16 pt-24 px-24" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="60px"
            fxLayoutGap.lt-md="0px">
            <mat-form-field fxFlex="45%" class="is-light form-primary">
              <input matInput type="text" formControlName="title"
                placeholder="{{'notification.popup_notifikasi.text3' | translate}}">
              <mat-error
                *ngIf="formPopupGroup.controls['title'].hasError('required') && formPopupGroup.controls['title'].touched">
                {{'notification.popup_notifikasi.text3' | translate}} {{'global.messages.mandatory_text' | translate}}
              </mat-error>
            </mat-form-field>
            <div fxFlex="45" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px" fxLayoutGap.lt-md="0px"
              *ngIf="formPopupGroup.value.is_mission_builder === false">
              <mat-form-field fxFlex="32" class="is-light form-primary">
                <input matInput [matDatepicker]="tanggal_terbit" (focus)="tanggal_terbit.open()" formControlName="date"
                  placeholder="{{'notification.popup_notifikasi.text7' | translate}}">
                <mat-error
                  *ngIf="formPopupGroup.controls['date'].hasError('required') && formPopupGroup.controls['date'].touched">
                  {{'notification.popup_notifikasi.text7' | translate}} {{'global.messages.mandatory_text' | translate}}
                </mat-error>
                <mat-datepicker-toggle matSuffix [for]="tanggal_terbit">
                  <mat-icon matDatepickerToggleIcon>date_range</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #tanggal_terbit></mat-datepicker>
              </mat-form-field>
              <mat-form-field fxFlex="15%" class="is-light form-primary" id="time">
                <input matInput formControlName="time" placeholder="Jam Terbit" [ngxTimepicker]="fullTime" [format]="24"
                  readonly>
                <mat-icon matSuffix>access_time</mat-icon>
                <ngx-material-timepicker #fullTime></ngx-material-timepicker>
                <mat-error
                  *ngIf="formPopupGroup.controls['time'].hasError('required') && formPopupGroup.controls['time'].touched">
                  {{'notification.popup_notifikasi.time' | translate}} {{'global.messages.mandatory_text' | translate}}
                </mat-error>
              </mat-form-field>
              <mat-form-field fxFlex="32" class="is-light form-primary">
                <input matInput [matDatepicker]="tanggal_berakhir" (focus)="tanggal_berakhir.open()"
                  formControlName="enddate" placeholder="{{ls.locale.manajemen_barang_sku.manajemen_koin.text16}}">
                <mat-error
                  *ngIf="formPopupGroup.controls['enddate'].hasError('required') && formPopupGroup.controls['enddate'].touched">
                  {{'notification.popup_notifikasi.text7' | translate}} {{'global.messages.mandatory_text' | translate}}
                </mat-error>
                <mat-datepicker-toggle matSuffix [for]="tanggal_berakhir">
                  <mat-icon matDatepickerToggleIcon>date_range</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #tanggal_berakhir></mat-datepicker>
              </mat-form-field>
              <mat-form-field fxFlex="15%" class="is-light form-primary" id="time">
                <input matInput formControlName="endtime"
                  placeholder="{{'notification.popup_notifikasi.text10' | translate}}" [ngxTimepicker]="fullTime1"
                  [format]="24" readonly>
                <mat-icon matSuffix>access_time</mat-icon>
                <ngx-material-timepicker #fullTime1></ngx-material-timepicker>
                <mat-error
                  *ngIf="formPopupGroup.controls['endtime'].hasError('required') && formPopupGroup.controls['endtime'].touched">
                  {{'notification.popup_notifikasi.time' | translate}} {{'global.messages.mandatory_text' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="px-24" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="60px" fxLayoutGap.lt-md="0px">
            <mat-form-field fxFlex="45%" class="is-light form-primary">
              <input matInput type="text" formControlName="positive_button"
                placeholder="{{'notification.popup_notifikasi.text11' | translate}}">
              <mat-error
                *ngIf="formPopupGroup.controls['positive_button'].hasError('required') && formPopupGroup.controls['positive_button'].touched">
                {{'notification.popup_notifikasi.text11' | translate}} {{'global.messages.mandatory_text' | translate}}
              </mat-error>
            </mat-form-field>
            <mat-form-field fxFlex="48%" class="is-light form-primary">
              <input matInput type="text" formControlName="negative_button"
                placeholder="{{'notification.popup_notifikasi.text12' | translate}}">
              <mat-error
                *ngIf="formPopupGroup.controls['negative_button'].hasError('required') && formPopupGroup.controls['negative_button'].touched">
                {{'notification.popup_notifikasi.text12' | translate}} {{'global.messages.mandatory_text' | translate}}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="px-24" fxLayout="row" fxLayoutAlign="start center">
            <h3><strong>{{'notification.buat_notifikasi.text12' | translate}}</strong></h3>
          </div>
          <div fxLayout="row" class="px-24" fxLayout.lt-md="column" fxLayoutGap.lt-md="0px">
            <mat-form-field fxFlex="45" class="is-light form-primary">
              <mat-select placeholder="{{'notification.buat_notifikasi.text13' | translate}}"
                formControlName="type_of_recurrence">
                <mat-option *ngFor="let item of listTypeOfRecurrence" [value]="item.id">{{item.name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div fxLayout="row" class="px-24" *ngIf="formPopupGroup.get('type_of_recurrence').value == 'recurring'"
            fxLayout.lt-md="column">
            <mat-form-field fxFlex="45" class="is-light form-primary">
              <mat-select placeholder="{{'notification.buat_notifikasi.repeat_pattern' | translate}}"
                formControlName="recurrence_type">
                <mat-option *ngFor="let item of listRecurrenceTypes" [value]="item.id">{{item.name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="px-24"
            *ngIf="formPopupGroup.get('type_of_recurrence').value == 'recurring' && formPopupGroup.get('recurrence_type').value === 'weekly'"
            [formGroup]="formWeeklyRecurrence">
            <div fxLayout="row wrap" fxLayoutAlign="space-between stretch" class="pb-16" fxLayoutGap="10px">
              <ng-container *ngFor="let item of listWeekDays">
                <mat-checkbox [formControlName]="item.id" [value]="item.id"></mat-checkbox> {{item.name}} &nbsp;
              </ng-container>
            </div>
          </div>
          <div fxLayout="row" class="px-24"
            *ngIf="formPopupGroup.get('type_of_recurrence').value == 'recurring' && formPopupGroup.get('recurrence_type').value === 'monthly'"
            [formGroup]="formMonthlyRecurrence" fxLayout.lt-md="column">
            <mat-form-field fxFlex="45" class="is-light form-primary">
              <mat-select placeholder="{{'global.label.date' | translate}}" formControlName="recurrence_date" multiple>
                <mat-option *ngFor="let item of listDates" [value]="item">{{item}}</mat-option>
              </mat-select>
              <mat-error
                *ngIf="formMonthlyRecurrence.controls['recurrence_date'].hasError('required') && formMonthlyRecurrence.controls['recurrence_date'].touched">
                {{'global.label.date' | translate}} {{'global.messages.mandatory_text' | translate}}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="px-24"
            *ngIf="formPopupGroup.get('type_of_recurrence').value == 'recurring' && formPopupGroup.get('recurrence_type').value === 'yearly'">
            <div fxLayout="row">
              <div style="font-weight:600;margin-right:20px;min-height:30px;">
                {{'notification.buat_notifikasi.selected_date' | translate}} : </div>
              <div>
                <mat-chip-list>
                  <mat-chip *ngFor="let item of listDateChosen.value" style="position:unset;margin:0 5px 0 0"
                    [removable]="true" (removed)="removeDateChosen(item)">
                    <span>{{item.name}}</span>
                    <mat-icon style="padding:0;" matChipRemove>cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </div>
              <mat-error style="font-size:75%;" *ngIf="listDateChosen.hasError('required') && listDateChosen.touched">
                {{'notification.buat_notifikasi.date_month_repeatation' | translate}} {{'global.messages.mandatory_text'
                | translate}}
              </mat-error>
            </div>
            <div fxLayout="row" [formGroup]="formYearlyRecurrence">
              <div fxFlex="45" fxFlex.lt-md="90" fxLayoutAlign="space-between stretch">
                <mat-form-field fxFlex="48" class="is-light form-primary">
                  <mat-select placeholder="{{'global.label.date' | translate}}" formControlName="recurrence_date">
                    <mat-option *ngFor="let item of listDates" [value]="item">{{item}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formYearlyRecurrence.controls['recurrence_date'].hasError('required') && formYearlyRecurrence.controls['recurrence_date'].touched">
                    {{'notification.buat_notifikasi.date_repeatation' | translate}} {{'global.messages.mandatory_text' |
                    translate}}.
                  </mat-error>
                </mat-form-field>
                <mat-form-field fxFlex="48" class="is-light form-primary">
                  <mat-select placeholder="Bulan" formControlName="recurrence_month">
                    <mat-option *ngFor="let item of listMonths" [value]="item.id">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formYearlyRecurrence.controls['recurrence_month'].hasError('required') && formYearlyRecurrence.controls['recurrence_month'].touched">
                    {{'notification.buat_notifikasi.month_repeatation' | translate}} {{'global.messages.mandatory_text'
                    | translate}}.
                  </mat-error>
                </mat-form-field>
              </div>
              <div style="padding-bottom:1.25em;font-size:16px;margin-left:15px;">
                <button mat-raised-button type="button" (click)="addRecurrenceDate()" style="height:100%;min-width:0;">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="px-24" fxLayout="row" fxLayoutAlign="start center">
            <h3 class="">
              <strong>{{'notification.popup_notifikasi.text13' | translate}}</strong>
            </h3>
          </div>
          <div class="px-24">
            <div ngfDrop selectable="1" class="rectangle-16" [(validDrag)]="validComboDrag" [(file)]="files"
              accept="image/*" [class.invalid-drag]="validComboDrag===false" [class.valid-drag]="validComboDrag"
              (fileChange)="changeImage($event)">
              <div class="p-24" fxLayout="column" fxLayoutAlign="center center">
                <mat-icon style="width: 48px;height: 48px;font-size: 48px;">add_photo_alternate_outline</mat-icon>
                <br>
                <span matPrefix>{{'notification.popup_notifikasi.text14' | translate}}</span>
                <!-- <span matPrefix>Besar file maksimal 2mb</span> -->
              </div>
            </div>
          </div>

          <div class="pt-16 px-24">
            <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="60px" fxLayoutGap.lt-md="0px">
              <div fxFlex="45" fxLayout="column">
                <mat-form-field class="is-light form-primary">
                  <mat-select formControlName="user_group"
                    placeholder="{{'notification.popup_notifikasi.text4' | translate}}">
                    <mat-option *ngFor="let item of listUserGroup" [value]="item.value">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formPopupGroup.controls['user_group'].hasError('required') && formPopupGroup.controls['user_group'].touched">
                    {{'notification.popup_notifikasi.text4' | translate}} {{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                </mat-form-field>
              </div>
              <div fxFlex="45">
                <div *ngIf="files">
                  <div class="mat-chip mat-primary mat-standard-chip mat-chip-with-trailing-icon ng-star-inserted"
                    role="option" tabindex="-1" aria-disabled="false" aria-selected="false"><span
                      class="preview-image-content"
                      (click)="previewImage(imageConverted)">{{'iklan_dalam_aplikasi.spanduk_online.view_image' |
                      translate}} popup notifikasi</span>
                    <mat-icon (click)="removeImage()" matTooltip="{{'global.label.delete_image' | translate}}"
                      class="mat-chip-remove mat-chip-trailing-icon mat-icon material-icons mat-icon-no-color ng-star-inserted"
                      matchipremove="" role="img" aria-hidden="true">cancel</mat-icon>
                  </div>
                </div>
                <!-- <div *ngIf="detailBanner.target_page.type === 'image' && !imageContentType">
                  <div class="mat-chip mat-primary mat-standard-chip mat-chip-with-trailing-icon ng-star-inserted" role="option" tabindex="-1" aria-disabled="false" aria-selected="false"><span class="preview-image-content" (click)="previewImage()">{{'iklan_dalam_aplikasi.spanduk_online.view_image' | translate}}</span></div>
                </div> -->
              </div>
            </div>
          </div>

          <!-- Consumer -->
          <div *ngIf="formPopupGroup.get('user_group').value === 'customer'">

            <div class="px-24">
              <div fxLayout="row">
                <mat-form-field fxFlex="45" class="is-light form-primary">
                  <mat-select formControlName="is_smoker"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text14' | translate}}">
                    <mat-option *ngFor="let item of listSmoker" [value]="item.value">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formPopupGroup.controls['is_smoker'].hasError('required') && formPopupGroup.controls['is_smoker'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.text14' | translate}} {{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="px-24" *ngIf="formPopupGroup.get('is_smoker').value !== 'yes'">
              <div fxLayout="row">
                <mat-form-field fxFlex="45" class="is-light form-primary">
                  <mat-select formControlName="verification"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text15' | translate}}">
                    <mat-option *ngFor="let item of listJenisKonsumen" [value]="item.value">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formPopupGroup.controls['verification'].hasError('required') && formPopupGroup.controls['verification'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.text15' | translate}} {{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="px-24">
              <div fxLayout="row">
                <mat-form-field fxFlex="45" class="is-light form-primary">
                  <mat-select formControlName="employee"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text13' | translate}}">
                    <mat-option *ngFor="let item of listEmployee" [value]="item.value">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formPopupGroup.controls['employee'].hasError('required') && formPopupGroup.controls['employee'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.text13' | translate}}{{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="px-24">
              <div fxLayout="row">
                <mat-form-field fxFlex="45" class="is-light form-primary">
                  <mat-select formControlName="subscription"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.subscription_status' | translate}}">
                    <mat-option *ngFor="let item of listSubscription" [value]="item.value">{{item.name}}</mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="formPopupGroup.controls['subscription'].hasError('required') && formPopupGroup.controls['subscription'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.subscription_status' | translate}}
                    {{'global.messages.mandatory_text' | translate}}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="pb-16 px-24">
              <div class="pb-8" fxLayout="row" fxLayoutAlign="start center">
                <strong class="font-size-16">{{'iklan_dalam_aplikasi.spanduk_online.text16' | translate}}</strong>
              </div>
              <div class="" fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="30px" fxLayoutGap.lt-md="0px">
                <mat-form-field fxFlex="20" class="is-light form-primary">
                  <input matInput type="number" formControlName="age_consumer_from"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text17' | translate}}">
                  <mat-error
                    *ngIf="formPopupGroup.controls['age_consumer_from'].hasError('required') && formPopupGroup.controls['age_consumer_from'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.text17' | translate}} {{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                  <mat-error
                    *ngIf="formPopupGroup.controls['age_consumer_from'].hasError('min') && formPopupGroup.get('age_consumer_from').touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.cannot_less_than' | translate}}
                    {{formPopupGroup.controls['is_smoker'].value === 'yes' ? '18' : '0'}}
                  </mat-error>
                </mat-form-field>
                <mat-form-field fxFlex="20" class="is-light form-primary">
                  <input matInput type="number" formControlName="age_consumer_to"
                    placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text18' | translate}}">
                  <mat-error
                    *ngIf="formPopupGroup.controls['age_consumer_to'].hasError('required') && formPopupGroup.controls['age_consumer_to'].touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.text18' | translate}} {{'global.messages.mandatory_text' |
                    translate}}
                  </mat-error>
                  <mat-error
                    *ngIf="formPopupGroup.controls['age_consumer_to'].hasError('min') && formPopupGroup.get('age_consumer_to').touched">
                    {{'iklan_dalam_aplikasi.spanduk_online.cannot_less_than' | translate}} minimal batasan umur yg telah
                    di isi
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="pb-16 px-24">
              <div class="" fxLayout="row" fxLayoutAlign="start center">
                <strong class="font-size-16">"{{'iklan_dalam_aplikasi.spanduk_online.text19' | translate}}"</strong>
              </div>
              <mat-radio-group formControlName="gender" class="radio-group">
                <mat-radio-button class="radio-button" *ngFor="let item of listGender" [value]="item.value">
                  {{item.name}}
                </mat-radio-button>
              </mat-radio-group>
            </div>
          </div>

          <div class="px-24">
            <div fxLayout="row">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <mat-select formControlName="content_type"
                  placeholder="{{'notification.popup_notifikasi.text15' | translate}}"
                  (selectionChange)="contentType(formPopupGroup.get('content_type').value)">
                  <mat-option *ngFor="let item of listContentType" [value]="item.value">{{item.name}}</mat-option>
                </mat-select>
                <mat-error
                  *ngIf="formPopupGroup.controls['content_type'].hasError('required') && formPopupGroup.controls['content_type'].touched">
                  {{'notification.popup_notifikasi.text15' | translate}} {{'global.messages.mandatory_text' |
                  translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="px-24" *ngIf="formPopupGroup.get('content_type').value === 'new-product'">
            <div fxLayout="row">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <mat-select formControlName="product" placeholder="{{'manajemen_barang_sku.produk.text4' | translate}}"
                  id="product_name" #singleSelect>
                  <ngx-mat-select-search [formControl]="filterProduct"
                    placeholderLabel="{{'global.label.search' | translate}}"
                    noEntriesFoundLabel="{{'global.messages.data_not_found' | translate}}" [clearSearchInput]="false">
                  </ngx-mat-select-search>
                  <mat-option *ngFor="let item of filteredProduct | async" [value]="item.sku_id">
                    {{item.name}}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="formPopupGroup.controls['product'].hasError('required') && formPopupGroup.controls['product'].touched">
                  {{'manajemen_barang_sku.produk.text4' | translate}} {{'global.messages.mandatory_text' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Static Page -->
          <div class="pb-24 px-24" *ngIf="formPopupGroup.get('content_type').value === 'static-page'">
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <h3 class="">{{'iklan_dalam_aplikasi.spanduk_online.text24' | translate}}</h3>
            </div>
            <textarea [froalaEditor]="options" formControlName="body" class="pb-4" fxFlex="100"></textarea>
            <mat-error style="padding-top: 6px !important; font-size: .86em;"
              *ngIf="formPopupGroup.controls['body'].hasError('required') && formPopupGroup.controls['body'].touched">
              {{'iklan_dalam_aplikasi.spanduk_online.text24' | translate}} {{'global.messages.mandatory_text' |
              translate}}
            </mat-error>
          </div>

          <!-- spesifik produk b2b -->
          <div class="px-24 pb-10" *ngIf="formPopupGroup.get('user_group').value === 'retailer' && formPopupGroup.get('content_type').value === 'spesific_product_b2b'">
            <div fxLayout="row">
              <search-product-barcode [errorMessage]="'Tidak ada produk ditemukan'" [inputPlaceHolder]="'Search Product'" fxFlex="45" [value]="formPopupGroup.controls['barcode'].value" (onChange)="handleSearchProduct($event)">
                <mat-error
                  *ngIf="formPopupGroup.controls['barcode'].hasError('required') && formPopupGroup.controls['barcode'].touched">
                  <!-- {{'iklan_dalam_aplikasi.spanduk_online.text24' | translate}} {{'global.messages.mandatory_text' |
                  translate}} -->
                  Barcode Produk Harus diisi
                </mat-error>
              </search-product-barcode>
            </div>
          </div>


          <!-- Landing Page -->
          <div class="px-24"
            *ngIf="formPopupGroup.get('content_type').value === 'landing-page' && formPopupGroup.get('user_group').value !== 'wholesaler'">
            <div fxLayout="row">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <mat-select formControlName="landing_page"
                  placeholder="{{'iklan_dalam_aplikasi.spanduk_online.landing_page_type' | translate}}">
                  <mat-option *ngFor="let item of listLandingPage" [value]="item.value">{{item.name}}</mat-option>
                </mat-select>
                <mat-error
                  *ngIf="formPopupGroup.controls['landing_page'].hasError('required') && formPopupGroup.controls['landing_page'].touched">
                  {{'iklan_dalam_aplikasi.spanduk_online.landing_page_type' | translate}}
                  {{'global.messages.mandatory_text' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- iframe -->
          <div class="px-24" *ngIf="formPopupGroup.get('content_type').value === 'iframe'">
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <input matInput type="url" formControlName="url_iframe"
                  placeholder="{{'notification.popup_notifikasi.text16' | translate}}">
                <mat-error
                  *ngIf="formPopupGroup.controls['url_iframe'].hasError('required') && formPopupGroup.controls['url_iframe'].touched">
                  {{'notification.popup_notifikasi.text16' | translate}} {{'global.messages.mandatory_text' |
                  translate}}
                </mat-error>
                <mat-error
                  *ngIf="formPopupGroup.controls['url_iframe'].hasError('pattern') && formPopupGroup.get('url_iframe').value !== ''">
                  {{'iklan_dalam_aplikasi.spanduk_online.invalid_url' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="pb-16 px-24" *ngIf="formPopupGroup.get('content_type').value === 'iframe'">
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <strong class="font-size-16">{{'notification.popup_notifikasi.text18' | translate}}</strong>
            </div>
            <mat-radio-group formControlName="transfer_token" class="radio-group">
              <mat-radio-button class="radio-button" value="yes">{{'global.label.yes' | translate}}</mat-radio-button>
              <mat-radio-button class="radio-button" value="no">{{'global.label.no' | translate}}</mat-radio-button>
            </mat-radio-group>
          </div>

          <!-- Image -->
          <div class="px-24 pb-16"
            *ngIf="formPopupGroup.get('user_group').value === 'customer' && formPopupGroup.get('content_type').value === 'image'">
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
              <div ngfDrop selectable="1" [(validDrag)]="validDragContentImage" [(file)]="fileContentImage"
                accept="image/*" class="well my-drop-zone" [class.invalid-drag]="validDragContentImage === false"
                [class.valid-drag]="validDragContentImage" (fileChange)="fileChangeContentImage($event)"
                [innerHTML]="'iklan_dalam_aplikasi.spanduk_online.drag_image' | translate">
              </div>
              <mat-chip-list *ngIf="fileContentImage">
                <mat-chip style="position:unset;margin:0;" (click)="previewImage(convertedContentImage)"
                  [removable]="true" (removed)="fileContentImage=undefined">
                  <span>{{'global.label.view_image' | translate}}</span>
                  <mat-icon style="padding:0;" matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </div>
          </div>

          <!-- link to web browser -->
          <div class="px-24"
            *ngIf="formPopupGroup.get('user_group').value === 'customer' && formPopupGroup.get('content_type').value === 'link_to_web_browser'">
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <input matInput type="url" formControlName="url_web"
                  placeholder="{{'notification.popup_notifikasi.text16' | translate}}">
                <mat-error
                  *ngIf="formPopupGroup.controls['url_web'].hasError('required') && formPopupGroup.controls['url_web'].touched">
                  {{'notification.popup_notifikasi.text16' | translate}} {{'global.messages.mandatory_text' |
                  translate}}
                </mat-error>
                <mat-error
                  *ngIf="formPopupGroup.controls['url_web'].hasError('pattern') && formPopupGroup.get('url_web').value !== ''">
                  {{'iklan_dalam_aplikasi.spanduk_online.invalid_url' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- E-Wallet -->
          <div class="pb-24 px-24"
            *ngIf="formPopupGroup.get('user_group').value === 'customer' && formPopupGroup.get('content_type').value === 'e_wallet'">
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <mat-select formControlName="content_wallet"
                  placeholder="{{'iklan_dalam_aplikasi.spanduk_online.wallet_type' | translate}}">
                  <mat-option *ngFor="let item of listContentWallet" [value]="item.id">{{item.app_name}}</mat-option>
                </mat-select>
                <mat-error
                  *ngIf="formPopupGroup.get('content_wallet').hasError('required') && formPopupGroup.get('content_wallet').touched">
                  {{'iklan_dalam_aplikasi.spanduk_online.wallet_type' | translate}} {{'global.messages.mandatory_text' |
                  translate}}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <mat-form-field fxFlex="45" class="is-light form-primary">
                <input matInput type="text" formControlName="button_text"
                  placeholder="{{'iklan_dalam_aplikasi.spanduk_online.text_button' | translate}}">
                <mat-error
                  *ngIf="formPopupGroup.get('button_text').hasError('required') && formPopupGroup.get('button_text').touched">
                  {{'iklan_dalam_aplikasi.spanduk_online.text_button' | translate}} {{'global.messages.mandatory_text' |
                  translate}}
                </mat-error>
                <mat-error
                  *ngIf="formPopupGroup.get('button_text').hasError('maxlength') && formPopupGroup.get('button_text').touched">
                  {{'iklan_dalam_aplikasi.spanduk_online.text_button' | translate}} Maksimal 30 karakter
                </mat-error>
              </mat-form-field>
            </div>
            <div class="" fxLayout="row" fxLayoutAlign="start center">
              <h3 class="">{{'iklan_dalam_aplikasi.spanduk_online.text24' | translate}}</h3>
            </div>
            <textarea [froalaEditor]="options" formControlName="body_wallet" class="pb-4" fxFlex="100"></textarea>
            <mat-error style="padding-top: 6px !important; font-size: .86em;"
              *ngIf="formPopupGroup.get('body_wallet').hasError('required') && formPopupGroup.get('body_wallet').touched">
              {{'iklan_dalam_aplikasi.spanduk_online.text24' | translate}} {{'global.messages.mandatory_text' |
              translate}}
            </mat-error>
          </div>

          <!-- Retailer -->
          <div *ngIf="formPopupGroup.get('user_group').value === 'retailer'">
            <div class="pb-16 px-24">
              <div class="" fxLayout="row" fxLayoutAlign="start center">
                <strong class="font-size-16">{{'iklan_dalam_aplikasi.spanduk_online.retailer_type' |
                  translate}}</strong>
              </div>
              <mat-radio-group formControlName="group_type" class="radio-group">
                <mat-radio-button class="radio-button" *ngFor="let item of listUserGroupType" [value]="item.value">
                  {{item.name}}
                </mat-radio-button>
              </mat-radio-group>
            </div>
          </div>
          <div *ngIf="formPopupGroup.value.is_mission_builder === false">
            <div fxLayout="row" fxLayoutGap="24px" class="pb-24 px-24">
              <mat-checkbox class="mt-4 ml-4 mb-8" (change)="isTargetAudience($event)"
                formControlName="is_target_audience">{{'iklan_dalam_aplikasi.spanduk_online.text26' | translate}}
              </mat-checkbox>
              <mat-checkbox *ngIf="formPopupGroup.get('user_group').value === 'customer'" class="mt-4 ml-4 mb-8"
                (change)="isTargetArea($event)" formControlName="is_target_area">
                {{'iklan_dalam_aplikasi.spanduk_online.target_area' | translate}}</mat-checkbox>
            </div>
            <ng-container *ngIf="formPopupGroup.get('is_target_area').value === true">
              <target-area (selectedArea)="getSelectedArea($event)" (selectedAll)="getSelectedAll($event)"
                (selectedAllId)="getSelectedAllId($event)" [isNotifValidation]="true"></target-area>
            </ng-container>
            <div [formGroup]="formFilter" *ngIf="formPopupGroup.get('is_target_audience').value === true">
              <div fxLayout="row wrap" fxLayoutAlign="space-between stretch" fxLayout.lt-md="column" class="px-24"
                fxLayoutGap="20px" fxLayoutGap.lt-md="0px">
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.national' | translate}}" formControlName="national">
                    <mat-option *ngFor="let item of listLevelArea" [value]="item.id">{{item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.zone' | translate}}" formControlName="zone" multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['zone'])" [value]="item.id">{{item.name ===
                      'all' ? 'Semua
                      Zona' :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.regional' | translate}}" formControlName="region" multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['region'])" [value]="item.id">{{item.name ===
                      'all' ? 'Semua
                      Regional'
                      :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.area' | translate}}" formControlName="area" multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['area'])" [value]="item.id">{{item.name ===
                      'all' ? 'Semua
                      Area'
                      :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.salespoint' | translate}}" formControlName="salespoint"
                    multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['salespoint'])" [value]="item.id">{{item.name
                      === 'all' ?
                      'Semua
                      Salespoint'
                      :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.district' | translate}}" formControlName="district" multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['district'])" [value]="item.id">{{item.name
                      === 'all' ? 'Semua
                      District'
                      :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.territory' | translate}}" formControlName="territory"
                    multiple>
                    <mat-option *ngFor="let item of filteringGeotree(list['territory'])" [value]="item.id">{{item.name
                      === 'all' ? 'Semua
                      Territori'
                      :
                      item.code}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <!-- <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.national' | translate}}" formControlName="national">
                    <mat-option *ngFor="let item of listLevelArea" [value]="item.id">{{item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.zone' | translate}}" formControlName="zone"
                    (selectionChange)="getAudienceArea('region', formFilter.get('zone').value)">
                    <mat-option *ngFor="let item of list['zone']" [value]="item.id">{{item.name === 'all' ? 'Semua
                      Zona' :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.regional' | translate}}" formControlName="region"
                    (selectionChange)="getAudienceArea('area', formFilter.get('region').value)">
                    <mat-option *ngFor="let item of list['region']" [value]="item.id">{{item.name === 'all' ? 'Semua
                      Regional'
                      :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.area' | translate}}" formControlName="area"
                    (selectionChange)="getAudienceArea('salespoint', formFilter.get('area').value)">
                    <mat-option *ngFor="let item of list['area']" [value]="item.id">{{item.name === 'all' ? 'Semua
                      Area'
                      :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.salespoint' | translate}}" formControlName="salespoint"
                    (selectionChange)="getAudienceArea('district', formFilter.get('salespoint').value)">
                    <mat-option *ngFor="let item of list['salespoint']" [value]="item.id">{{item.name === 'all' ?
                      'Semua
                      Salespoint'
                      :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.district' | translate}}" formControlName="district"
                    (selectionChange)="getAudienceArea('territory', formFilter.get('district').value)">
                    <mat-option *ngFor="let item of list['district']" [value]="item.id">{{item.name === 'all' ? 'Semua
                      District'
                      :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field fxFlex="12%" class="is-light form-primary">
                  <mat-select placeholder="{{'global.area.territory' | translate}}" formControlName="territory">
                    <mat-option *ngFor="let item of list['territory']" [value]="item.id">{{item.name === 'all' ? 'Semua
                      Territori'
                      :
                      item.name}}</mat-option>
                  </mat-select>
                </mat-form-field> -->
              </div>
            </div>
            <div class="p-0" *ngIf="formPopupGroup.get('is_target_audience').value === true">
              <div fxLayout="row wrap" fxLayout.lt-md="column" fxLayoutGap="20px" fxLayoutGap.lt-md="10px"
                fxLayoutAlign="end center" class="p-16 export">
                <a #downloadLink></a>
                <button mat-raised-button type="button" class="is-danger" (click)="import()">
                  <mat-icon>arrow_downward</mat-icon> Import XLSX
                </button>
                <button mat-raised-button type="button" class="is-danger" (click)="export()">
                  <mat-icon>arrow_upward</mat-icon> Export XLSX
                </button>
              </div>
              <mat-progress-bar [color]="'primary'" [mode]="'indeterminate'" *ngIf="loadingIndicator">
              </mat-progress-bar>
              <ngx-datatable class="material" [rows]="rows" [loadingIndicator]="loadingIndicator" [columnMode]="'force'"
                [headerHeight]="48" [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true"
                [reorderable]="reorderable" [count]="pagination.total" [limit]="pagination.per_page"
                [externalPaging]="true" [externalSorting]="true" (page)="setPage($event)" (sort)="onSort($event)"
                [selected]="selected" [selectionType]="'checkbox'" (select)='onSelect($event)'
                [selectCheck]='selectCheck'>

                <ngx-datatable-column [width]="68" [canAutoResize]="false" [sortable]="false">
                  <!-- <ng-template ngx-datatable-header-template let-value="value" let-allRowsSelected="allRowsSelected"
                    let-selectFn="selectFn">
                    <mat-checkbox [checked]="allRowsSelected" (change)="selectFn(!allRowsSelected)"></mat-checkbox>
                  </ng-template> -->

                  <ng-template ngx-datatable-cell-template let-row="row" let-value="value" let-isSelected="isSelected"
                    let-onCheckboxChangeFn="onCheckboxChangeFn">
                    <mat-checkbox [checked]="bindSelector(isSelected, row)" (change)="onSelectAudience($event, row)">
                    </mat-checkbox>
                  </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-column name="{{ls.locale.global.label.name}}" prop="name"></ngx-datatable-column>
                <ngx-datatable-column name="Kode" prop="code" [sortable]="false">
                  <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
                    {{row.code ? row.code : '-'}}
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Owner" prop="owner">
                  <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
                    {{row.owner ? row.owner : '-'}}
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Tipe" prop="type">
                  <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
                    {{row.type.toUpperCase()}}
                  </ng-template>
                </ngx-datatable-column>
              </ngx-datatable>
            </div>

            <div *ngIf="!formPopupGroup.get('is_target_audience').value && !formPopupGroup.get('is_target_area').value">
              <div class="pt-16" formArrayName="areas"
                *ngFor="let wil of formPopupGroup.get('areas')['controls']; let i = index;">
                <div [formGroupName]="i">
                  <div class="mb-16 wilayah" fxLayout="row" fxLayoutAlign="space-between center">
                    <div fxFlex="50">
                      <h3 class="">&nbsp;</h3>
                    </div>
                    <div *ngIf="!isDetail" fxFlex="50" fxLayout="row wrap" fxLayoutAlign="end center"
                      fxLayout.lt-md="column" fxLayoutGap="10px" fxLayoutGap.lt-md="0px">
                      <button
                        *ngIf="formPopupGroup.get('areas').value.length === 1 || i === (formPopupGroup.get('areas').value.length - 1)"
                        mat-raised-button type="button" (click)="addArea()">
                        <mat-icon>add</mat-icon>
                      </button>
                      <button *ngIf="formPopupGroup.get('areas').value.length > 1" mat-raised-button color="primary"
                        type="button" (click)="deleteArea(i)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                  <div class="pb-8 px-24" fxLayout="row wrap" fxLayout.lt-md="column" fxLayoutGap="20px"
                    fxLayoutGap.lt-md="0px" fxLayoutAlign="space-between stretch">
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.national' | translate}}" formControlName="national"
                        matTooltip="{{getToolTipData(wil.get('national').value, wil.controls['list_national'].value)}}">
                        <mat-option *ngFor="let item of wil.controls['list_national'].value" [value]="item.id">
                          {{item.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error
                        *ngIf="wil.controls['national'].hasError('required') && wil.controls['national'].touched">
                        {{'global.area.national' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.zone' | translate}}" formControlName="zone"
                        matTooltip="{{getToolTipData(wil.get('zone').value, wil.controls['list_zone'].value)}}"
                        (selectionChange)="generataList('region', wil.get('zone').value, i, 'selection')">
                        <mat-option *ngFor="let item of wil.controls['list_zone'].value" [value]="item.id">{{item.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="wil.controls['zone'].hasError('required') && wil.controls['zone'].touched">
                        {{'global.area.zone' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.regional' | translate}}" formControlName="region"
                        matTooltip="{{getToolTipData(wil.get('region').value, wil.controls['list_region'].value)}}"
                        (selectionChange)="generataList('area', wil.get('region').value, i, 'selection')">
                        <mat-option *ngFor="let item of wil.controls['list_region'].value" [value]="item.id">
                          {{item.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="wil.controls['region'].hasError('required') && wil.controls['region'].touched">
                        {{'global.area.regional' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.area' | translate}}" formControlName="area"
                        matTooltip="{{getToolTipData(wil.get('area').value, wil.controls['list_area'].value)}}"
                        (selectionChange)="generataList('salespoint', wil.get('area').value, i, 'selection')">
                        <mat-option *ngFor="let item of wil.controls['list_area'].value" [value]="item.id">{{item.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error *ngIf="wil.controls['area'].hasError('required') && wil.controls['area'].touched">
                        {{'global.area.area' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.salespoint' | translate}}" formControlName="salespoint"
                        matTooltip="{{getToolTipData(wil.get('salespoint').value, wil.controls['list_salespoint'].value)}}"
                        (selectionChange)="generataList('district', wil.get('salespoint').value, i, 'selection')">
                        <mat-option *ngFor="let item of wil.controls['list_salespoint'].value" [value]="item.id">
                          {{item.name}}</mat-option>
                      </mat-select>
                      <mat-error
                        *ngIf="wil.controls['salespoint'].hasError('required') && wil.controls['salespoint'].touched">
                        {{'global.area.salespoint' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.district' | translate}}" formControlName="district"
                        matTooltip="{{getToolTipData(wil.get('district').value, wil.controls['list_district'].value)}}"
                        (selectionChange)="generataList('territory', wil.get('district').value, i, 'selection')">
                        <mat-option *ngFor="let item of wil.controls['list_district'].value" [value]="item.id">
                          {{item.name}}
                        </mat-option>
                      </mat-select>
                      <mat-error
                        *ngIf="wil.controls['district'].hasError('required') && wil.controls['district'].touched">
                        {{'global.area.district' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="31%" class="is-light form-primary">
                      <mat-select placeholder="{{'global.area.territory' | translate}}" formControlName="territory"
                        matTooltip="{{getToolTipData(wil.get('territory').value, wil.controls['list_territory'].value)}}">
                        <mat-option *ngFor="let item of wil.controls['list_territory'].value" [value]="item.id">
                          {{item.name}}</mat-option>
                      </mat-select>
                      <mat-error
                        *ngIf="wil.controls['territory'].hasError('required') && wil.controls['territory'].touched">
                        {{'global.area.territory' | translate}} {{'global.messages.mandatory_text' | translate}}
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="confirm p-24" fxLayout="row" fxLayoutGap="20px">
          <button mat-raised-button type="button" class="confirmation-button" (click)="submit()" fxFlex="20">
            {{ls.locale.global.button.save}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>