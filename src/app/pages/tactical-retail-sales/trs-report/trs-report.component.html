<div class="page-layout simple fullwidth" fxLayout="column" fusePerfectScrollbar>
  <page-content-header contentTitle="Report">
  </page-content-header>

  <div class="content p-24" *ngIf="!onLoad">
    <div class="table-wrapper">
      <mat-tab-group [selectedIndex]="selectedTab" (selectedTabChange)="onChangeTab($event)">
        <mat-tab label="Total Pack Per Brand">
          <div class="button-row" fxLayout="row-reverse">
            <button (click)="exportTotalPerBrand()" mat-raised-button type="button" class="">
              <mat-icon>arrow_upward</mat-icon> Export XLSX
            </button>
          </div>
          <ngx-datatable class="material" [rows]="totalPerBrandTableData.rows"
            [loadingIndicator]="totalPerBrandTableData.loadingIndicator" [columnMode]="'force'"
            [offset]="totalPerBrandTableData.offsetPagination" [headerHeight]="48" [footerHeight]="56"
            [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]="totalPerBrandTableData.reorderable"
            [count]="totalPerBrandTableData.pagination.total" [limit]="totalPerBrandTableData.pagination.per_page"
            [externalPaging]="true" [externalSorting]="true" (page)="setTotalPerBrandPage($event)"
            (sort)="onTotalPerBrandSort($event)">

            <ngx-datatable-column name="Program Code" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.program_code}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Brand" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.brand}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Qty" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.totalqty}}</span>
              </ng-template>
            </ngx-datatable-column>

          </ngx-datatable>
        </mat-tab>

        <mat-tab label="Visit">
          <h2 class="pl-16">Summary Visit</h2>
          <div class="button-row" fxLayout="row-reverse">
            <button (click)="exportSummaryVisit()" mat-raised-button type="button" class="">
              <mat-icon>arrow_upward</mat-icon> Export XLSX
            </button>
          </div>
          <ngx-datatable class="material" [rows]="summaryVisitTableData.rows"
            [loadingIndicator]="summaryVisitTableData.loadingIndicator" [columnMode]="'force'"
            [offset]="summaryVisitTableData.offsetPagination" [headerHeight]="48" [footerHeight]="56"
            [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]="summaryVisitTableData.reorderable"
            [count]="summaryVisitTableData.pagination.total" [limit]="summaryVisitTableData.pagination.per_page"
            [externalPaging]="true" [externalSorting]="true" (page)="setSummaryVisitPage($event)"
            (sort)="onSummaryVisitSort($event)">

            <ngx-datatable-column name="Executor" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.created_at}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Customer Name" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.outlet_name}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="# Visits" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.visits}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="# Invoice Issued" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.issued}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="# Invoice Cancel" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.cancel}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Early Visit" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.start_visit}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Last Visit" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.end_visit}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Modus Timespent" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.timespent_modus}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Min Timespent" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.timespent_min}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Max Timespent" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.timespent_max}}</span>
              </ng-template>
            </ngx-datatable-column>

          </ngx-datatable>
          <hr />

          <h2 class="pl-16">Detail Visit</h2>
          <h2 class="pl-16">TSUB0002 - Saiful Rahman - 27/06/2022</h2>
          <div class="button-row" fxLayout="row-reverse">
            <button (click)="exportDetailVisit()" mat-raised-button type="button" class="">
              <mat-icon>arrow_upward</mat-icon> Export XLSX
            </button>
          </div>
          <ngx-datatable class="material" [rows]="detailVisitTableData.rows"
            [loadingIndicator]="detailVisitTableData.loadingIndicator" [columnMode]="'force'"
            [offset]="detailVisitTableData.offsetPagination" [headerHeight]="48" [footerHeight]="56"
            [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]="detailVisitTableData.reorderable"
            [count]="detailVisitTableData.pagination.total" [limit]="detailVisitTableData.pagination.per_page"
            [externalPaging]="true" [externalSorting]="true" (page)="setDetailVisitPage($event)"
            (sort)="onDetailVisitSort($event)">

            <ngx-datatable-column name="Date Visit" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.created_at}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Customer Name" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.outlet_name}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Image" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <a *ngIf="row.photo" href="{{row.photo}}" target="_blank">
                  <img class="row-photo" src="{{row.photo}}" />
                </a>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Koordinat Alamat" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.lat}}, {{row.lng}}<br />{{row.address}}<br /><a target="_blank" *ngIf="row.gmap"
                    href="{{row.gmap}}">Open
                    Maps</a></span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="# Invoice Issued" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.issued}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="# Invoice Cancel" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.cancel}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Start Visit" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.start_visit}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="End Visit" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.end_visit}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Timespent" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.timespent}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Revenue" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.revenue}}</span>
              </ng-template>
            </ngx-datatable-column>

          </ngx-datatable>
        </mat-tab>

        <mat-tab label="Stock Movement">
          <div class="button-row" fxLayout="row-reverse">
            <button (click)="exportStockMovement()" mat-raised-button type="button" class="">
              <mat-icon>arrow_upward</mat-icon> Export XLSX
            </button>
          </div>
          <ngx-datatable class="material" [rows]="stockMovementTableData.rows"
            [loadingIndicator]="stockMovementTableData.loadingIndicator" [columnMode]="'force'"
            [offset]="stockMovementTableData.offsetPagination" [headerHeight]="48" [footerHeight]="56"
            [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]="stockMovementTableData.reorderable"
            [count]="stockMovementTableData.pagination.total" [limit]="stockMovementTableData.pagination.per_page"
            [externalPaging]="true" [externalSorting]="true" (page)="setStockMovementPage($event)"
            (sort)="onStockMovementSort($event)">

            <ngx-datatable-column name="Executor" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.partner_from}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Territory Code" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.partner_from_territory}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Brand" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.product_code}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Quantity" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.qty}}</span>
              </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Total Transaksi" [sortable]="true" [width]="200">
              <ng-template ngx-datatable-cell-template let-row="row">
                <span>{{row.total}}</span>
              </ng-template>
            </ngx-datatable-column>

          </ngx-datatable>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>

  <a #downloadLink></a>
</div>
