<div class="page-layout simple fullwidth" fxLayout="column" fusePerfectScrollbar>
  <!-- HEADER -->
  <page-content-header [contentTitle]="(isDetail ? 'Detil' : 'Ubah') + ' Task Sequence'">
    <div class="button-row" fxLayout="row">
      <div fxLayout="column">
        <button id="btn-export-coin" mat-raised-button style="border: 1px solid; margin-right: 10px" (click)="export()" [disabled]="!ENABLE_EXPORT_IF.includes(taskSequenceForm.get('export_coin_status').value)">
          <mat-icon>arrow_upward</mat-icon>
          EXPORT COIN
        </button>
        <label *ngIf="!ENABLE_EXPORT_IF.includes(taskSequenceForm.get('export_coin_status').value)" style="margin: 0px 0 0 15px;">Requesting File</label>
        <a *ngIf="taskSequenceForm.get('export_coin_status').value === 'done' && taskSequenceForm.get('export_coin_result').value"
          [href]="taskSequenceForm.get('export_coin_result').value" style="margin: 10px 0 0 15px; font-weight: bolder; color: white;">Download File</a>
        <!-- <label style="margin: 0px 0 0 15px;">Download File</label> -->
      </div>
      <a #downloadLink></a>
      <button id="btn-import-coin" mat-raised-button style="border: 1px solid" (click)="import()" *ngIf="!isDetail">
        <mat-icon>arrow_downward</mat-icon>
        IMPORT COIN
      </button>
    </div>
  </page-content-header>
  <!-- / HEADER -->

  <div class="content p-24">
    <div fxLayout="row" fxLayoutAlign="space-around">
      <img fxFlex="30" [src]="'assets/images/ayo/tsm.png'" style="max-width: 30%; margin-top: 3rem">
      <div fxFlex="40">
        <div fxLayout="row" fxLayoutAlign="space-between">
          <span class="h1"><strong>{{ isDetail ? 'Detil' : 'Ubah' }} Task Sequence</strong></span>
        </div>
        <form name="form" [formGroup]="taskSequenceForm" (keydown.enter)="$event.preventDefault();">

          <!-- <ng-template matStepLabel>Informasi Dasar</ng-template> -->

          <div fxFlex="1 0 auto" fxLayout="column" fxLayoutAlign="start">

            <!--<mat-form-field fxFlex="100" class="is-light">
              <input matInput type="text" placeholder="Nama Trade Program" formControlName="namaTrade">
              <mat-error
                *ngIf="taskSequenceForm.controls['namaTrade'].hasError('required') && taskSequenceForm.controls['namaTrade'].touched ">
                Nama Trade harus diisi.
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100" class="is-light">
              <input matInput type="text" placeholder="Budget" formControlName="budget">
              <mat-error
                *ngIf="taskSequenceForm.controls['budget'].hasError('required') && taskSequenceForm.controls['budget'].touched ">
                Budget harus diisi.
              </mat-error>
            </mat-form-field>-->
            <mat-form-field fxFlex="100" class="is-light">
              <input id="input-nama" matInput type="text" placeholder="Nama" formControlName="name"
                [readonly]="data?.is_editable === 0">
              <mat-error
                *ngIf="taskSequenceForm.controls['name'].hasError('required') && taskSequenceForm.controls['name'].touched ">
                Nama harus diisi.
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100" class="is-light form-primary">
              <!-- <mat-select placeholder="Pilih Trade Program" formControlName="trade_program" id="trade_program">
                <mat-option *ngFor="let item of programs" [value]="item.id">{{item.name}}</mat-option>
              </mat-select> -->
              <mat-select [disabled]="data?.is_editable === 0" formControlName="trade_creator_id"
                placeholder="Pilih Trade Program" id="trade_creator_id" (selectionChange)="selectChange($event)"
                #singleSelect>
                <ngx-mat-select-search [formControl]="filterGTP" [placeholderLabel]="'Cari Trade Program...'"
                  [noEntriesFoundLabel]="'Tidak ada Trade Program yang ditemukan'" [clearSearchInput]="false">
                </ngx-mat-select-search>
                <mat-option *ngFor="let item of filteredGTP | async" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
              <mat-error
                *ngIf="taskSequenceForm.controls['trade_creator_id'].hasError('required') && taskSequenceForm.controls['trade_creator_id'].touched">
                Pilih salah satu trade program.
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100" class="is-light form-primary">
              <!-- <mat-select placeholder="Pilih Group Audience" formControlName="group_audience" id="group_audience">
                <mat-option *ngFor="let item of audiences" [value]="item.id">{{item.name}}</mat-option>
              </mat-select> -->
              <mat-select [disabled]="data?.is_editable === 0" formControlName="trade_audience_group_id"
                placeholder="Pilih Group Audience" id="trade_audience_group_id"
                (selectionChange)="selectChangeAudince($event)" #singleSelect>
                <ngx-mat-select-search [formControl]="filterGTA" [placeholderLabel]="'Cari Group Trade Audience...'"
                  [noEntriesFoundLabel]="'Tidak ada Group Audience yang ditemukan'" [clearSearchInput]="false">
                </ngx-mat-select-search>
                <mat-option *ngFor="let item of filteredGTA | async" [value]="item.id">
                  {{item.name}}
                </mat-option>
              </mat-select>
              <mat-error
                *ngIf="taskSequenceForm.controls['trade_audience_group_id'].hasError('required') && taskSequenceForm.controls['trade_audience_group_id'].touched">
                Pilih salah satu group audience.
              </mat-error>
            </mat-form-field>

            <h3 class="h3"><strong>Masa Berlaku Task Sequence</strong></h3>

            <mat-form-field fxFlex="100" class="is-light">
              <input id="start-date" matInput (focus)="start_date.open()" [max]="maxDate" [min]="minDate" [matDatepicker]="start_date"
                placeholder="Pilih Tanggal Mulai" formControlName="start_date" [readonly]="data?.is_editable === 0">
              <mat-datepicker-toggle matSuffix [for]="start_date" [disabled]="data?.is_editable === 0">
              </mat-datepicker-toggle>
              <mat-datepicker #start_date [disabled]="data?.is_editable === 0"></mat-datepicker>
              <mat-error class="mt-8 px-24"
                *ngIf="taskSequenceForm.controls['start_date'].hasError('required') && taskSequenceForm.controls['start_date'].touched">
                Tanggal mulai harus diisi.
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100" class="is-light">
              <input id="end-date" matInput (focus)="end_date.open()" [max]="maxDate" [min]="minDate" [matDatepicker]="end_date"
                placeholder="Pilih Tanggal Berakhir" formControlName="end_date" [readonly]="data?.is_editable === 0">
              <mat-datepicker-toggle matSuffix [for]="end_date" [disabled]="data?.is_editable === 0">
              </mat-datepicker-toggle>
              <mat-datepicker #end_date [disabled]="data?.is_editable === 0"></mat-datepicker>
              <mat-error class="mt-8 px-24"
                *ngIf="taskSequenceForm.controls['end_date'].hasError('required') && taskSequenceForm.controls['end_date'].touched">
                Tanggal berakhir harus diisi.
              </mat-error>
            </mat-form-field>
            <button id="{{isDetail ? 'btn-detail' : 'btn-edit'}}" mat-raised-button type="button" class="confirmation-button" fxFlex="20" (click)="submit()"
              [disabled]="taskSequenceForm.controls['name'].invalid || taskSequenceForm.controls['trade_creator_id'].invalid || taskSequenceForm.controls['trade_audience_group_id'].invalid || taskSequenceForm.controls['start_date'].invalid || taskSequenceForm.controls['end_date'].invalid"
              [routerLink]="['/dte','mission-builder',(isDetail ? 'detail' : 'edit')]">
              {{ isDetail ? 'CEK DETIL' : 'SUBMIT' }}
            </button>

          </div>

        </form>
      </div>
    </div>
  </div>
</div>