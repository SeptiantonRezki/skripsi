<div class="page-layout simple fullwidth" #containerScroll fxLayout="column" fusePerfectScrollbar>
  <!-- HEADER -->
  <page-content-header [contentTitle]="isDetail ? 'Detail B2C Voucher' : 'Edit B2C Voucher'"> <!-- // TODO -->
  </page-content-header>
  <!-- / HEADER -->
  <div class="content p-24">
    <div class="ayo-main-wrapper mat-white-bg p-0" fxLayout="column">

      <mat-tab-group [selectedIndex]="selectedTab" (selectedTabChange)="onChangeTab($event)">
        <mat-tab label="Detail Voucher"> <!-- // TODO -->
          <div class="ayo-middle" fxLayout="column">
            <form autocomplete="off" [formGroup]="formDetailVoucher" (keydown.enter)="$event.preventDefault();">
              <div fxLayout.gt-xs="row wrap" fxLayout="column" fxLayoutGap="20px" class="top-table p-8 pt-24 ml-24">
                <mat-form-field fxFlex.gt-xs="50" class="is-light pb-12">
                  <input matInput type="text" placeholder="{{ls.locale.cn_reward.b2b_voucher.text2}}" formControlName="name"> <!-- // TODO -->
                  <mat-error
                    *ngIf="formDetailVoucher.controls['name'].hasError('required') && formDetailVoucher.controls['name'].touched ">
                    {{ls.locale.cn_reward.b2b_voucher.text2}} harus diisi.
                  </mat-error> <!-- // TODO -->
                </mat-form-field>
                <mat-form-field fxFlex.gt-xs="50" class="is-light pb-12">
                  <input matInput type="text" placeholder="Nama Lain Voucher" formControlName="alias"> <!-- // TODO -->
                  <mat-error
                    *ngIf="formDetailVoucher.controls['alias'].hasError('required') && formDetailVoucher.controls['alias'].touched ">
                    Nama Lain Voucher harus diisi. <!-- // TODO -->
                  </mat-error>
                </mat-form-field>
                <div fxLayout.gt-xs="row" fxLayout="column" fxFlex.gt-xs="50" fxLayoutGap="20px">
                  <mat-form-field class="is-light pb-12" fxFlex.gt-xs="50">
                    <input matInput type="number" placeholder="Nilai Voucher" formControlName="voucherValue"> <!-- // TODO -->
                    <mat-error
                      *ngIf="formDetailVoucher.controls['voucherValue'].hasError('required') && formDetailVoucher.controls['voucherValue'].hasError('min') && formDetailVoucher.controls['voucherValue'].touched ">
                      Nilai Voucher harus diisi.
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>
                  <mat-form-field class="is-light pb-12" fxFlex.gt-xs="50">
                    <input matInput type="number" placeholder="Jumlah Voucher per Consumer"
                      formControlName="jumlahVoucherPerConsumer"> <!-- // TODO -->
                    <mat-error
                      *ngIf="formDetailVoucher.controls['jumlahVoucherPerConsumer'].hasError('required') && formDetailVoucher.controls['jumlahVoucherPerConsumer'].hasError('min') &&formDetailVoucher.controls['jumlahVoucherPerConsumer'].touched ">
                      Jumlah Voucher per Consumer harus diisi.
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>
                </div>
                <div fxLayout.gt-xs="row" fxLayout="column" fxFlex.gt-xs="50" fxLayoutGap="20px">
                  <mat-form-field class="is-light form-primary pb-12" fxFlex.gt-xs="50">
                    <input matInput (focus)="startPicker.open()" [matDatepicker]="startPicker"
                      placeholder="Tanggal Awal Program" formControlName="startDate" [min]="minDateVoucher" (dateChange)="onDateChange('startVoucher', $event)"> <!-- // TODO -->
                    <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                    <mat-datepicker #startPicker></mat-datepicker>
                    <mat-error
                      *ngIf="formDetailVoucher.controls['startDate'].hasError('required') && formDetailVoucher.controls['startDate'].touched">
                      Tanggal Awal Program harus diisi.
                    </mat-error> <!-- // TODO -->
                    <mat-error *ngIf="formDetailVoucher.controls['startDate'].invalid">
                      Tanggal Tidak Valid
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>

                  <mat-form-field class="is-light form-primary pb-12" fxFlex.gt-xs="50">
                    <input matInput (focus)="endDate.open()"
                      [matDatepicker]="endDate" placeholder="Tanggal Akhir Program" formControlName="endDate" [min]="endVoucher" (dateChange)="onDateChange('endVoucher', $event)"> <!-- // TODO -->
                    <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                    <mat-datepicker #endDate></mat-datepicker>
                    <mat-error
                      *ngIf="formDetailVoucher.controls['endDate'].hasError('required') && formDetailVoucher.controls['endDate'].touched">
                      Tanggal Akhir Program harus diisi.
                    </mat-error> <!-- // TODO -->
                    <mat-error *ngIf="formDetailVoucher.controls['endDate'].invalid">
                      Tanggal Tidak Valid
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>
                </div>
                <div fxLayout.gt-xs="row" fxLayout="column" fxFlex.gt-xs="50" fxLayoutGap="20px">
                  <mat-form-field class="is-light form-primary pb-12" fxFlex.gt-xs="50">
                    <input matInput (focus)="voucherPicker.open()" [matDatepicker]="voucherPicker"
                      placeholder="Tanggal Awal Pemakaian Voucher" formControlName="available_at"
                      [min]="useVoucher" (dateChange)="onDateChange('useVoucher', $event)"> <!-- // TODO -->
                    <mat-datepicker-toggle matSuffix [for]="voucherPicker"></mat-datepicker-toggle>
                    <mat-datepicker #voucherPicker></mat-datepicker>
                    <mat-error
                      *ngIf="formDetailVoucher.controls['available_at'].hasError('required') && formDetailVoucher.controls['available_at'].touched">
                      Tanggal Awal Pemakaian Voucher harus diisi.
                    </mat-error> <!-- // TODO -->
                    <mat-error *ngIf="formDetailVoucher.controls['available_at'].invalid">
                      Tanggal Tidak Valid
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>

                  <mat-form-field class="is-light form-primary pb-12" fxFlex.gt-xs="50">
                    <input matInput (focus)="voucherExpiry.open()"
                      [matDatepicker]="voucherExpiry"
                      placeholder="Tanggal Kedaluwarsa Voucher" formControlName="expired_at" [min]="usedVoucher" (dateChange)="onDateChange('usedVoucher', $event)"> <!-- // TODO -->
                    <mat-datepicker-toggle matSuffix [for]="voucherExpiry"></mat-datepicker-toggle>
                    <mat-datepicker #voucherExpiry></mat-datepicker>
                    <mat-error
                      *ngIf="formDetailVoucher.controls['expired_at'].hasError('required') && formDetailVoucher.controls['expired_at'].touched">
                      Tanggal Kedaluwarsa Voucher harus diisi.
                    </mat-error> <!-- // TODO -->
                    <mat-error *ngIf="formDetailVoucher.controls['expired_at'].invalid">
                      Tanggal Tidak Valid
                    </mat-error> <!-- // TODO -->
                  </mat-form-field>
                </div>
              </div>
              <div class="p-8 pb-8 ml-24" fxLayout="row" fxLayoutAlign="start center">
                <span class="font-size-16">Batasan</span> <!-- // TODO -->
              </div>
              <div fxLayout.gt-xs="row wrap" fxLayout="column" fxLayoutGap="20px" class="top-table p-8 ml-24">
                <div fxFlex="100" fxLayoutGap="20px">
                  <mat-checkbox formControlName="limit_by_product" (change)="isChecked('product', $event)">
                    {{ls.locale.cn_reward.b2b_voucher.text26}}
                  </mat-checkbox> <!-- // TODO -->
                  <mat-checkbox formControlName="limit_by_category" (change)="isChecked('category', $event)">
                    Batasi Dengan Kategori
                  </mat-checkbox> <!-- // TODO -->
                  <mat-checkbox formControlName="limit_purchase" (change)="isCheckedPembelianMinimum($event)">
                    Berlaku Pembelian Minimum
                  </mat-checkbox> <!-- // TODO -->
                </div>
                <mat-form-field fxFlex="50" class="pt-20 is-light"
                  *ngIf="formDetailVoucher.get('limit_by_product').value">
                  <mat-chip-list #chipList aria-label="Product List">
                    <mat-chip *ngFor="let product of productList" [selectable]="selectable" [removable]="removable"
                      (removed)="remove(product)">
                      {{product.name}}
                      <mat-icon matChipRemove *ngIf="removable" (click)="remove(product.sku_id)">cancel</mat-icon>
                    </mat-chip>
                    <input matInput type="text" #productInput placeholder="{{ls.locale.cn_reward.b2b_voucher.text29}}"
                      (input)="keyUpProduct.next($event.target.value)" [formControl]="product" [matAutocomplete]="auto"
                      [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                      (matChipInputTokenEnd)="add($event)" *ngIf="detailVoucher?.is_enable_detail_voucher"> <!-- // TODO -->
                  </mat-chip-list>
                  <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayProductName">
                    <mat-option *ngFor="let item of filteredSkuOptions | async" [value]="item"
                      (onSelectionChange)="getProductObj(item)">
                      {{item.name}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <mat-form-field fxFlex="50" class="is-light"
                  *ngIf="formDetailVoucher.get('limit_by_product').value">
                  <input matInput type="number" placeholder="Pembelian Minimum Berdasarkan Produk" formControlName="limit_only_purchase"> <!-- // TODO -->
                </mat-form-field>
                <mat-form-field fxFlex="50" class="pt-24 is-light"
                  *ngIf="!formDetailVoucher.get('limit_by_product').value">
                  <input matInput type="text" placeholder="{{ls.locale.cn_reward.b2b_voucher.text29}}" [disabled]="true"> <!-- // TODO -->
                </mat-form-field>
                <mat-form-field class="is-light" fxFlex="50">
                  <mat-select placeholder="{{ls.locale.cn_reward.b2b_voucher.text30}}" formControlName="category"
                    [disabled]="!formDetailVoucher.get('limit_by_category').value || !detailVoucher?.is_enable_detail_voucher"
                    multiple> <!-- // TODO -->
                    <mat-option *ngFor="let cat of listCategories" [value]="cat.id">{{ cat.name }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field class="is-light" fxFlex="50">
                  <input matInput type="number" placeholder="Batasan Berdasarkan Pembelian"
                    formControlName="minimumPurchase" *ngIf="formDetailVoucher.get('limit_purchase').value"> <!-- // TODO -->
                  <input matInput type="number" placeholder="Batasan Berdasarkan Pembelian"
                    *ngIf="!formDetailVoucher.get('limit_purchase').value" [disabled]="true"> <!-- // TODO -->
                  <mat-error
                    *ngIf="formDetailVoucher.controls['minimumPurchase'].hasError('required') && formDetailVoucher.controls['minimumPurchase'].touched">
                    Batasan Berdasarkan Pembelian harus diisi
                  </mat-error> <!-- // TODO -->
                </mat-form-field>
              </div>
              <h4 class="ml-24 p-8" style="font-weight: bold;">Penggunaan Voucher</h4> <!-- // TODO -->
              <div fxLayout="row wrap" fxLayoutGap="20px" class="top-table p-8 ml-24">
                <div fxFlex="60" fxLayoutGap="20px">
                  <mat-checkbox *ngFor="let item of usage" [value]="item.value" [checked]="formDetailVoucher.controls['usage'].value.indexOf(item.value) >= 0" (change)="onUsageChange($event)" [disabled]="disableForm">{{item.label}}</mat-checkbox>
                  <mat-error *ngIf="formDetailVoucher.controls['usage'].errors?.required" class="pt-20">
                    Penggunaan Voucher harus dipilih
                  </mat-error> <!-- // TODO -->
                </div>
              </div>
              <div class="confirm p-24" fxLayout="row" fxLayoutAlign="center center"
                *ngIf="!isDetail && detailVoucher?.is_enable_detail_voucher">
                <button mat-raised-button type="button" class="confirmation-button" fxFlex="30" fxFlex.gt-xs="20"
                  (click)="onSaveDetail()" [disabled]="disableForm">
                  {{ls.locale.global.button.save}}
                </button> <!-- // TODO -->
              </div>
            </form>
          </div>
        </mat-tab>
        <mat-tab label="Panel Retailer"> <!-- // TODO -->
          <app-panel-retailer-voucher [data]="detailVoucher" [isLimitVoucher]="isLimitVoucher" (onRefresh)="onRefresh()" (setSelectedTab)="setSelectedTab($event)"></app-panel-retailer-voucher>
        </mat-tab>
        <mat-tab label="Panel Consumer"> <!-- // TODO -->
          <app-panel-consumer-voucher [data]="detailVoucher" (onChangeVoucherAutomation)="onChangeVoucherAutomation($event)" (onRefresh)="onRefresh()" (scrollToTop)="scrollToTop()" (setSelectedTab)="setSelectedTab($event)"></app-panel-consumer-voucher>
        </mat-tab>
        <mat-tab label="Penukaran Voucher"> <!-- // TODO -->
          <app-penukaran-voucher [data]="detailVoucher" (onRefresh)="onRefresh()" (setSelectedTab)="setSelectedTab($event)"></app-penukaran-voucher>
        </mat-tab>
        <mat-tab label="Design Voucher"> <!-- // TODO -->
          <app-design-voucher [data]="detailVoucher" (onRefresh)="onRefresh()" (setSelectedTab)="setSelectedTab($event)"></app-design-voucher>
        </mat-tab>
        <mat-tab label="Preview Voucher"> <!-- // TODO -->
          <app-preview-voucher [data]="detailVoucher" (onRefresh)="onRefresh()"></app-preview-voucher>
        </mat-tab>
        <mat-tab label="List Detail Voucher"> <!-- // TODO -->
          <app-list-detail-voucher [data]="detailVoucher"></app-list-detail-voucher>
        </mat-tab>
      </mat-tab-group>
      
    </div>
  </div>
</div>